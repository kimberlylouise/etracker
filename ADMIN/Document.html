<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>eTracker Admin Dashboard</title>
  <link rel="stylesheet" href="Document.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

</head>
<body>

    
  <div class="sidebar">
    <h2>eTracker Admin</h2>
    <a href="Dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
    <a href="User.html"><i class="fas fa-users"></i> User Management</a>
    <a href="Programs.html"><i class="fas fa-calendar-alt"></i> Program Schedule</a>
    <a href="Attendance.html"><i class="fas fa-check-square"></i> Attendance Tracker</a>
    <a href="Evaluation.html"><i class="fas fa-poll"></i> Evaluation & Feedback</a>
    <a href="Reports.html"><i class="fas fa-chart-bar"></i> Reports & Analytics</a>
    <a href="Document.html"><i class="fas fa-folder"></i> Document Management</a>
    <a href="Certificates.html"><i class="fas fa-certificate"></i> Certificates</a>
  
  </div>

    <div class="main">
        <h1>Document Management</h1>
      
        <section class="filter-section">
          <h2>Filter Documents</h2>
          <form>
            <label for="docTypeFilter">Document Type</label>
            <select id="docTypeFilter" name="docTypeFilter">
              <option value="">-- All Types --</option>
              <option value="proposal">Extension Activity Proposal</option>
              <option value="report">Implementation Report</option>
              <option value="attendance">Attendance Sheet</option>
              <option value="evaluation">Evaluation Form</option>
              <option value="photo">Photo Documentation</option>
              <option value="certificate">Certificate</option>
              <option value="other">Other Supporting Document</option>
            </select>
      
            <label for="uploaderFilter">Submitted By</label>
            <input type="text" id="uploaderFilter" name="uploaderFilter" placeholder="e.g., Dr. Santos">
      
            <button type="submit">Apply Filters</button>
          </form>
        </section>
      
        <section class="documents-table">
          <h2>Submitted Documents</h2>
          <table border="1" cellpadding="6" cellspacing="0">
            <thead>
              <tr>
                <th>ID</th>
                <th>Program ID</th>
                <th>Faculty ID</th>
                <th>Document Type</th>
                <th>File Path</th>
                <th>Original Filename</th>
                <th>Upload Date</th>
                <th>Status</th>
                <th>Admin Remarks</th>
                <th>Reviewed By</th>
                <th>Reviewed At</th>
                <th>Uploaded By</th>
              </tr>
            </thead>
            <tbody id="documentsTableBody">
              <!-- Rows will be inserted here by JavaScript -->
            </tbody>
          </table>
        </section>
      </div>
      
      <script>
async function fetchDocuments() {
  const res = await fetch('/backend/get_documents.php');
  const docs = await res.json();
  return docs;
}

function renderDocumentsTable(docs) {
  const tbody = document.getElementById('documentsTableBody');
  tbody.innerHTML = '';
  if (!docs.length) {
    tbody.innerHTML = '<tr><td colspan="12">No documents found.</td></tr>';
    return;
  }
  docs.forEach(doc => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${doc.id}</td>
      <td>${doc.program_id}</td>
      <td>${doc.faculty_id}</td>
      <td>${doc.document_type}</td>
      <td>${doc.file_path}</td>
      <td>${doc.original_filename}</td>
      <td>${doc.upload_date}</td>
      <td>${doc.status}</td>
      <td>${doc.admin_remarks || ''}</td>
      <td>${doc.reviewed_by || ''}</td>
      <td>${doc.reviewed_at || ''}</td>
      <td>${doc.uploaded_by || ''}</td>
    `;
    tbody.appendChild(row);
  });
}

document.querySelector('.filter-section form').onsubmit = async function(e) {
  e.preventDefault();
  const docs = await fetchDocuments();
  renderDocumentsTable(docs);
};

// Initial load
window.addEventListener('DOMContentLoaded', async () => {
  const docs = await fetchDocuments();
  console.log(docs); // Debug: See what is fetched
  renderDocumentsTable(docs);
});

// View document (simple, for PDFs/images)
function viewDocument(path) {
  window.open(path, '_blank');
}

// Review modal (approve/reject)
function showReviewModal(id) {
  const modal = document.createElement('div');
  modal.style.position = 'fixed';
  modal.style.top = 0;
  modal.style.left = 0;
  modal.style.right = 0;
  modal.style.bottom = 0;
  modal.style.background = 'rgba(30,41,59,0.45)';
  modal.style.display = 'flex';
  modal.style.alignItems = 'center';
  modal.style.justifyContent = 'center';
  modal.style.zIndex = 1000;
  modal.innerHTML = `
    <div style="background:#fff;max-width:400px;width:95%;border-radius:10px;padding:24px 20px;position:relative;">
      <button onclick="this.parentNode.parentNode.remove()" style="position:absolute;top:10px;right:16px;font-size:1.5rem;background:none;border:none;cursor:pointer;">&times;</button>
      <h2>Review Document</h2>
      <textarea id="adminRemarks" placeholder="Remarks (optional)" style="width:100%;min-height:60px;"></textarea>
      <div style="margin-top:12px;text-align:right;">
        <button onclick="reviewDocument(${id},'approved')">Approve</button>
        <button onclick="reviewDocument(${id},'rejected')">Reject</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
}

async function reviewDocument(id, status) {
  const remarks = document.getElementById('adminRemarks').value;
  await fetch(`/backend/review_document.php`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({id, status, remarks})
  });
  document.querySelectorAll('#adminRemarks').forEach(el => el.closest('div[style]').parentNode.remove());
  const docs = await fetchDocuments();
  renderDocumentsTable(docs);
}

async function deleteDocument(id) {
  if (!confirm('Delete this document?')) return;
  await fetch(`/backend/delete_document.php?id=${id}`, { method: 'POST' });
  const docs = await fetchDocuments();
  renderDocumentsTable(docs);
}
</script>
</body>
</html>
